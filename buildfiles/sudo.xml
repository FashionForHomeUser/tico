<?xml version="1.0" encoding="UTF-8"?>
<project name="sudo" basedir="." default="sudoMain">
	<!-- check for sudo privileges -->
	<target name="testsudo">
		<exec command="groups | grep sudo" returnProperty="tico.sudo.return" />
		<if>
			<equals arg1="0" arg2="${tico.sudo.return}" />
			<then>
				<property name="tico.sudo.issudo" value="1" override="true" />
				<property name="tico.sudo.prefix" value="sudo" override="true" />
			</then>
		</if>
	</target>

	<!-- check for root account -->
	<target name="testroot">
		<if>
			<equals arg1="0" arg2="${tico.sudo.issudo}" />
			<then>
				<exec command="whoami" outputProperty="tico.sudo.output" />
				<if>
					<equals arg1="root" arg2="${tico.sudo.output}" />
					<then>
						<property name="tico.sudo.issudo" value="1" override="true" />
					</then>
				</if>
			</then>
		</if>
	</target>

	<!-- check that we have sudo privileges, otherwise fail -->
	<target name="issudo">
		<if>
			<equals arg1="1" arg2="${tico.sudo.issudo}" />
			<then>
				<echo message="You have sudo privileges, continue ..." />
			</then>
			<else>
				<fail message="You don't have sudo privileges. Use an account which have it. Execution stops!"/>
			</else>
		</if>
	</target>

	<!-- combines all the tasks to check if sudo privileges exist -->
	<target name="sudoMain" depends="testsudo,testroot,issudo" />
</project>
